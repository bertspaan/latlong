<!DOCTYPE html>
<html>
<head>
	<title>Latitude/longitude of a point</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<link rel="stylesheet" href="style.css" />
	<script src="d3.v3.min.js"></script>
  <link href='http://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
  <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>
  <script src="leaflet-hash.js"></script>
</head>
<body>
	<div id="map"></div>
  <div id="bar" class="leaflet-bar">
    <label for='latlong'>Latitude, longitude</label>
    <input type="text" id='latlong' name='latlong' />
  </div>  
	<script>
		var map = L.map('map');
    var hash = new L.Hash(map);
    
    var tileUrl = "http://otile2.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png";

		var tileLayer = L.tileLayer(tileUrl, {
      attributionControl: false,
			minZoom: 2
		}).addTo(map);

    drawCrossHair();

    map.setView([52.3674, 4.915], 6);
    
    map.on('move', function() {      
  		updateLatlong();
    });
    
    function textWidth(text) {
      return text.length * 17.2 + "px";
    }
    
    d3.select('input').on('input', function() {
      var latlong = d3.select(this).property('value');
      d3.select(this).style('width', textWidth(latlong));
    });
    
    function drawCrossHair() {
      var crosshairLength = 10,
          crosshair = [
        [0, -1], [1, 0], [0, 1], [-1, 0]
      ];
      
      var g = d3.select(".leaflet-control-container")
        .append("div")
          .attr("class", "leaflet-middle")
        .append("svg")
          .attr("class", "crosshair")
          .attr("width", 64)
          .attr("height", 64)
        .append("svg:g")
          .attr("transform", "translate(32,32)")
          .selectAll('line')
          .data(crosshair);
      
      g.enter().append('line')
          .attr("class", "crosshair-outline")
          .attr("x1", function(d) { return d[0] * crosshairLength; })
          .attr("y1", function(d) { return d[1] * crosshairLength; })
          .attr("x2", function(d) { return d[0] * crosshairLength * 2; })
          .attr("y2", function(d) { return d[1] * crosshairLength * 2; });
        
      g.enter().append('line')
          .attr("x1", function(d) { return d[0] * crosshairLength; })
          .attr("y1", function(d) { return d[1] * crosshairLength; })
          .attr("x2", function(d) { return d[0] * crosshairLength * 2; })
          .attr("y2", function(d) { return d[1] * crosshairLength * 2; });
    }
           
    function updateLatlong() {
  		var center = map.getCenter(),
  		    zoom = map.getZoom(),
	        precision = Math.max(0, Math.ceil(Math.log(zoom) / Math.LN2));          
          
      var latlong = center.lat.toFixed(precision) + ', ' + center.lng.toFixed(precision);      
      
      d3.select('input')
          .property('value', latlong)
          .style('width', textWidth(latlong));
    }
    
    updateLatlong();       
	</script>
</body>
</html>